---
layout: post
title: "编码乱谈"
date: 2022-08-27 03:29:44
categories: 编码
tags: 编码
---

* content
{:toc}


首先明确几个概念

### **字符集**
每种语言中都有字符，这些字符的集合构成了该语言的“字符集”。对字符进行编码时，会为其分配唯一标识符或称为代码点的数字。在计算机中，这些代码点将由一个或多个字节表示。

**字符集示例：** ASCII（涵盖所有英文字符），ISO/IEC 646，Unicode（涵盖
世界上所有现存语言的字符）

### **编码字符集**
编码字符集是为每个字符分配唯一编号的集合。该唯一编号称为“代码点”。
编码字符集有时称为代码页。

### **编码**
编码是一种将代码点与一些字节映射的机制，以便可以使用相同的编码方案在不同系统中统一读取和写入字符。

**编码示例：** ASCII，Unicode编码方案，如UTF-8，UTF-16，UTF-32。

引自: https://stackoverflow.com/questions/2281646/whats-the-difference-between-encoding-and-charset

>字符是给人看的,编码是给计算机看的

![](/assets/HLOXV.png)

## 发展过程
### （1）单字节

**ASCII**（American Standard Code for Information Interchange），128个字符，用7位二进制表示（00000000-01111111即0x00-0x7F）;

**EASCII**（Extended ASCII）,256个字符，用8位二进制表示（00000000-11111111即0x00-0xFF）。

当计算机传到了欧洲，国际标准化组织在ASCII的基础上进行了扩展，形成了ISO-8859标准，跟EASCII类似，兼容ASCII，在高128个码位上有所区别。但是由于欧洲的语言环境十分复杂，所以根据各地区的语言又形成了很多子标准，ISO-8859-1、ISO-8859-2、ISO-8859-3、……、ISO-8859-16。
 
### （2）双字节
当计算机传到了亚洲，256个码位就不够用了。于是乎继续扩大二维表，单字节改双字节，16位二进制数，65536个码位。在不同国家和地区又出现了很多编码，大陆的GB2312、港台的BIG5、日本的Shift JIS等等。
 
注意65536个码位这种说法只是理想情况，由于双字节编码可以是变长的，也就是说同一个编码里面有些字符是单字节表示，有些字符是双字节表示。这样做的好处是，一方面可以兼容ASCII，另一方面可以节省存储容量，代价就是会损失一部分码位。
 
**GBK**(Chinese Internal Code Specification)是GB2312的扩展（gbk编码能够用来同时表示繁体字和简体字），按理说都属于双字节编码，码位是一样的，根本谈不上扩展，但实际上是预留空间在起作用。比如下图为GBK的编码空间，GBK/1、GBK/2是GB2312的区域，GBK/3、GBK/4、GBK/5是GBK的区域，红色是用户自定义区域，白色可能就是由于变长编码损失的区域了。


### （3）多字节

当互联网席卷了全球，地域限制被打破了，不同国家和地区的计算机在交换数据的过程中，就会出现乱码的问题，即对同一组二进制数据，不同的编码会解析出不同的字符。

**通用字符集UCS**（Universal Character Set）

对应两种编码：对每一个字符采用四个8比特字节编码的称为UCS-4，对每一个字符采用两个8比特字节编码的称为UCS-2。

**UNICODE字符集**

有多个编码方式，分别是UTF-8，UTF-16，UTF-32编码。

引自: https://www.cnblogs.com/xdyixia/p/9114145.html


``vs`` 上默认的 ``unicode`` 应该是 ``utf16`` ``wide char``
``ANSI`` 应该是本地编码 ``gbk``? ``char``



对于英语,其字符总数不超过256	
对于汉语,其字符总数远远超过256个.常见的思路为:对于汉语书写中出现的英语字符,比如大小写字母,符号等,使用一个不超过0x80的字节表示;对于汉字,使用多个连续的,取值大于0x80的字节表示.

GB2312能够表示常见的简体汉字,每个汉字占2个字节;
另一种汉字编码方案尾Big5,主要用来表示繁体汉字.
常见的英语字符也被纳入这些编码方案中,他们的编号余ASCII方案下的完全相同.
我们将这种一个字符可能对应一个或者多个字节的编码方案成为多字节编码(multibyte encoding).
[多字节编码使用较少的字节表示使用频率较高的字符,可以有效的降低保存字符的存储容量,常被用在文件系统,网络传输等场合.
但是对于计算机内部字符串处理,由于每个字符所占字节数不同,解析过程会降低运行速度.]

类似于以上汉语的编码思路,日语有JIS编码,其他自然语言也有着各自的编码方案.这些编码方案中,多数方案只表示一个自然语言中的字符,最好情形下也只能表示其他自然语言的少数字符
因而,每个方案在设计之初就没有考虑如何兼容其他自然语言的字符,导致不同的自然语言中的字符可能被映射为相同的字节序列.

当操作系统本身采用这种编码方式时,情况会变得更糟.
例如香港用户采用Big5编码的windows 95/98创建了一些文档,这些文档被传输到基于GB2312编码的windows平台时,却无法正常显示处理.


因此从xp时代开始,微软将编码方案从原来的多字节编码转换成了Unicode.
Unicode 是国际组织制定的可以容纳世界上所有文字和符号的字符编码方案

Unicode为世界上的各种语言的每个字符指定一个统一,唯一的编号.
但是将这个编号转换为字节序列时却有着不同的方案,从而形成不同的Unicode编码方案,
如UTF-8,UTF-16等.

UTF-8采用多字节编码,常用的英语字符采用1个字节表示,其他的字符采用2到4个字节表示.
UTF-16使用2个字节来表示常用字符,对于不常用的字符用4个字节来表示.

多字节编码方式使用较少的字节来表示使用频率较高的字符
对于频率很低的字符才会使用较多的字节，因而这种方式可以有效的降低保存字符的存储容量，常常被用在文件系统、网络传输

然而这种方式并不适用于计算机内部对字符串的处理。由于每个字符占用字节数不同，程序必须从第一个字符串首位字节开始解析以确定每个字符对应字节序列在内存中的位置，毫无疑问这个解析过程会极大的降低程序运行速度。如果采用多字节编码（比如utf-8）我们必须遍历整个字节流才能得到字符串包含多少个字符


为了提高字符串处理速度,计算机常采用固定长度的存储单元来存放每个字符.
使用Unicode存储的字符称为宽字符(wide characters).
采用这种存储方式，我们能够很容易地在一个字节流中定位每个字符的其实、终止位置，也能够轻易地求取一个字符串的字符个数。

ANSI原意是指美国国家标准协会,但是在windows系统中,ANSI编码意思却代表“本地编码”
也就是说，在中国代表GBK，在台湾代表Big5，在日本代表JIS，==>Multibyte
所以windows编程中常说的ANSI字符串，就是指本地编码的字符串，在中国，就是一种DBCS，用1个和2个字节表示一个字符的编码。



> 2024年4月16日更新
个人认为:
visual studio 上的默认编码应该有两种
1. char* 形式的gbk，可视
2. wchar_t*(即L 宽字符)，此时也可见

一般要做的转码形式即 utf8上的 gbk->utf8 或者 wide_string -> string